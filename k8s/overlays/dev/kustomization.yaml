# ========================================
# Development Environment Overlay
# ========================================

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: openmarket-dev

resources:
  - ../../base
  - namespace.yaml

# ConfigMap Patches for Dev Environment
configMapGenerator:
  - name: openmarket-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - API_URL=https://api.dev.openmarket.example.com
      - FRONTEND_URL=https://dev.openmarket.example.com

# Secret Patches (from Terraform outputs)
# These will be replaced by actual values from AWS Secrets Manager via External Secrets Operator
secretGenerator:
  - name: openmarket-secrets
    behavior: merge
    envs:
      - secrets.env

# Resource Patches
patches:
  - path: backend-patch.yaml
  - path: frontend-patch.yaml
  - path: ingress-patch.yaml

# Image Tags
images:
  - name: 478266318018.dkr.ecr.ap-northeast-2.amazonaws.com/openmarket/backend
    newTag: dev-latest
  - name: 478266318018.dkr.ecr.ap-northeast-2.amazonaws.com/openmarket/frontend-web
    newTag: dev-latest

# Replicas
replicas:
  - name: backend-api
    count: 2
  - name: frontend-web
    count: 2

# Common Labels for Dev
labels:
  - pairs:
      environment: development
      tier: dev
